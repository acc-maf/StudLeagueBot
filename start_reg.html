<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <datalist id = "clubs">
        <option value="TechnoMafia"></option>
        <option value="Чёрный ход"></option>
        <option value="LETI-MAFIA"></option>
        <option value="BONCHMAFIA"></option>
        <option value="Polytech mafia community"></option>
        <option value="Mining Mafia"></option>
        <option value="Вечерняя партия"></option>
        <option value="Polemica SPb"></option>
        <option value="Иллюzия ОбмаNа"></option>
        <option value="TITAN SPb"></option>
    </datalist>
    <div>
        <h1 style="text-align: center;">Создание турнира</h1>
    </div>
    <form style="text-align: center;">
        <input type="text" placeholder="Ник" id="nick">
        <input type="text" list="clubs" placeholder="Клуб" id="club">
        <br>
        <label for="pp">Отправьте ваше фото, которое будет использоваться для анонсов турниров и мероприятий</label>
        <input type="file" id="pp" accept="image/png, image/jpeg">
        <div id="error"></div>
        <br>
        <button id="reg">Зарегистрироваться</button>
    </form>
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <script>
        let tg = window.Telegram.WebApp;
        let reg = document.getElementById("reg");
        tg.expand();

        reg.addEventListener("click", (event) => {
            event.preventDefault();
            let nick = document.getElementById("nick").value;
            let club = document.getElementById("club").value;
            let ppInput = document.getElementById("pp").files[0];

            if (nick.length == 0) {
                document.getElementById("error").innerText = "Вы не ввели ник!";
                return;
            }
            if (club.length == 0) {
                document.getElementById("error").innerText = "Вы не ввели клуб!";
                return;
            }

            toBase64(ppInput).then(base64String => {
                let data = {
                    nick: nick,
                    club: club,
                    pp: base64String // передаем закодированное изображение
                }
                tg.sendData(JSON.stringify(data));
                tg.close();
            });
        });

        function toBase64(file) {
            return new Promise((resolve) => {
                let reader = new FileReader();
                reader.onload = () => {
                    resolve(reader.result); // Возвращаем результат
                };
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
